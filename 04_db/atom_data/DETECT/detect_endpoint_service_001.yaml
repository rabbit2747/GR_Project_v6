# GR Atom: Service Event
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "DETECT-ENDPOINT-SERVICE-001"
  name: "Service Event"
  normalized_name: "service_event"
  aliases:
    - "Windows Service Event"
    - "Service Control Manager Event"
    - "SCM Event"
    - "System Service Activity"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "pattern"
  abstraction_level: 2
  atom_tags:
    - EDR
    - SIEM
    - AUDIT
    - LOG
    - WINDOWS
    - OS

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L5", "L6"]
  target_zones: ["Z1", "Z2", "Z3", "Z4"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    A Service Event is a telemetry record generated by the operating system's service control
    subsystem when any state change occurs to a system service (daemon on Unix-like systems).
    On Windows, these events originate from the Service Control Manager (SCM, services.exe) and
    are logged primarily through Windows Event Log channels including System (Event IDs 7034-7046),
    Security (Event IDs 4697, 4688), and Microsoft-Windows-Services (ETW provider). Service events
    capture the full lifecycle of system services: installation (new service registration), start,
    stop, pause, resume, configuration changes, failure recovery actions, and deletion. Each event
    record typically includes the service name, display name, service type (kernel driver, file
    system driver, Win32 own process, Win32 share process), start type (auto, manual, disabled,
    delayed auto), account context (LocalSystem, LocalService, NetworkService, or domain account),
    binary path, and the action that triggered the event. On Linux, equivalent telemetry comes from
    systemd journal entries (systemctl operations), syslog daemon notifications, and auditd service
    unit monitoring. Service events represent a parent category encompassing all specific service
    lifecycle operations including installation, start, stop, restart, enable, disable, update,
    and deletion events.
  why: >-
    Service events are among the most critical endpoint telemetry sources for security monitoring
    because adversaries routinely abuse system services for persistence (MITRE T1543.003 - Create
    or Modify System Process: Windows Service), privilege escalation (running malicious code as
    SYSTEM), defense evasion (disabling security services), and execution (service-based malware
    deployment). The installation of a new service on a production system is a high-fidelity
    indicator that warrants investigation, as legitimate service installations are relatively
    infrequent on stable systems. Attackers commonly create malicious services with names mimicking
    legitimate ones (e.g., "Windows Update Service") to blend with normal activity. Monitoring
    service events enables detection of unauthorized persistence mechanisms, service account
    abuse, security tool tampering (stopping or disabling EDR/AV services), and lateral movement
    via remote service creation through tools like PsExec and sc.exe.
  how: >-
    Service event detection is implemented through multi-source telemetry collection and correlation.
    On Windows, the primary collection points are: (1) Windows Event Log - System channel for SCM
    events (7034 service crashed, 7035 service sent start/stop, 7036 service entered state, 7040
    start type changed, 7045 new service installed), Security channel for service installation
    auditing (4697), and process creation (4688) for sc.exe and services.exe activity; (2) ETW
    providers including Microsoft-Windows-Services and Microsoft-Windows-Kernel-General for
    real-time service telemetry; (3) Sysmon Event IDs for driver loading (ID 6) and process
    creation with service context (ID 1); (4) EDR agents that hook service control APIs
    (CreateService, StartService, ChangeServiceConfig) for real-time interception. Detection
    rules typically baseline normal service activity per system role and alert on anomalies
    including new service creation, services running from unusual paths (temp directories, user
    profiles), services configured with suspicious binary paths containing cmd.exe or PowerShell,
    services running under unexpected accounts, and modification or stopping of security-related
    services.
  core_concepts:
    - key: "Service Control Manager (SCM)"
      value: >-
        The Windows component (services.exe) responsible for managing the lifecycle of all system
        services, including starting, stopping, and maintaining service state. SCM events are the
        primary source of service telemetry on Windows systems.
    - key: "Service Lifecycle"
      value: >-
        The complete sequence of states a service transitions through: installation (registration
        with SCM), configuration, start, running, pause, resume, stop, and deletion. Each
        transition generates observable telemetry.
    - key: "Service Persistence"
      value: >-
        The technique of using system services as a persistence mechanism, ensuring malicious
        code executes automatically on system boot. Services configured for automatic start
        survive reboots and run with the privileges of their configured account.

# ==== Section 6: Relations ====
relations:
  - type: "abstracts"
    target: "DETECT-ENDPOINT-SERVINST-001"
    description: "Service Event is the general category that abstracts specific service installation events"
  - type: "abstracts"
    target: "DETECT-ENDPOINT-SERVSTAR-001"
    description: "Service Event is the general category that abstracts specific service start events"
  - type: "abstracts"
    target: "DETECT-ENDPOINT-SERVSTOP-001"
    description: "Service Event is the general category that abstracts specific service stop events"
  - type: "abstracts"
    target: "DETECT-ENDPOINT-SERVDELE-001"
    description: "Service Event is the general category that abstracts specific service deletion events"
  - type: "abstracts"
    target: "DETECT-ENDPOINT-SERVREST-001"
    description: "Service Event is the general category that abstracts specific service restart events"
  - type: "effective_against"
    target: "ATK-PERSIST-CRMOSY-001"
    description: "Service event monitoring is effective at detecting adversary persistence through service creation or modification"
  - type: "requires"
    target: "DETECT-LOG-WINEVENT-001"
    description: "Service event detection on Windows requires Windows Event Log collection infrastructure"

# ==== Section 7: Security Profile ====
security_profile:
  mitre_mapping:
    technique_id: "T1543.003"
    tactic:
      - "Persistence"
      - "Privilege Escalation"
    sub_techniques:
      - "T1543.003"
  defense_context:
    effectiveness: "high"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "Microsoft Documentation - System Services Events. https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/audit-security-system-extension"
    - "Microsoft Documentation - Event ID 7045 (New Service Installed). https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc756313(v=ws.10)"
    - "MITRE ATT&CK T1543.003 - Create or Modify System Process: Windows Service. https://attack.mitre.org/techniques/T1543/003/"
    - "Sysmon Documentation - Event ID 6 (Driver Loaded). https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon"
  search_keywords:
    - "service event"
    - "windows service monitoring"
    - "service control manager"
    - "SCM event"
    - "service installation detection"
    - "service persistence"
    - "event id 7045"
    - "event id 4697"
    - "service lifecycle monitoring"
    - "endpoint service telemetry"
  embedding_text: >-
    Service Event is an endpoint detection pattern covering the full lifecycle of operating system
    services, primarily monitored through the Windows Service Control Manager (SCM). Service events
    capture installation, start, stop, restart, configuration changes, and deletion of system
    services, generating telemetry through Windows Event Log (Event IDs 7034-7046, 4697), ETW
    providers, Sysmon, and EDR agent API hooking. Service monitoring is critical for detecting
    adversary persistence via T1543.003 (Create or Modify System Process: Windows Service),
    privilege escalation through SYSTEM-level service execution, defense evasion by disabling
    security services, and lateral movement via remote service creation tools like PsExec.
    Detection approaches baseline normal service activity per system role and alert on anomalies
    including new service creation, unusual binary paths, suspicious service accounts, and
    modification of security-critical services. On Linux, equivalent monitoring covers systemd
    unit changes, daemon management, and auditd service tracking.
