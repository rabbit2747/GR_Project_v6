# GR Atom: Windows Registry Key Update Event
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "DETECT-ENDPOINT-WIREKEUP-001"
  name: "Windows Registry Key Update Event"
  normalized_name: "windows_registry_key_update_event"
  aliases:
    - "Registry Key Modification"
    - "Registry Key Change"
    - "Registry Key Metadata Update"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "pattern"
  abstraction_level: 1
  atom_tags:
    - EDR
    - SIEM
    - AUDIT
    - LOG
    - MONITOR
    - PERSIST
    - WINDOWS

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L6", "L7"]
  target_zones: ["Z1", "Z2", "Z3"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: "A detection pattern that captures general update or modification operations on Windows registry keys that do not fall into specific subcategories like creation, deletion, or renaming. This encompasses changes to key metadata, class information, and other key-level attributes. It also serves as a catch-all for registry key operations detected through Windows Security audit events where the specific operation type maps to key modification. Sources include Sysmon registry events, Windows Security Event IDs 4656/4657 with KEY_SET_VALUE or KEY_WRITE access, and ETW registry providers."
  why: "Registry key update events capture modifications that may not trigger specific creation, deletion, or rename detections but still represent significant changes to registry structure. Adversaries may modify key class information, update key metadata for timestomping purposes, or perform operations that are categorized as updates rather than specific operations. Monitoring generic key updates ensures comprehensive coverage of all registry modification activity."
  how: "Detection monitors Sysmon registry events for modification operations that are not creation, deletion, or renaming. Windows Security Event ID 4657 captures registry key modifications when SACLs are configured with appropriate access masks. ETW providers capture key-level update operations. EDR agents categorize registry operations and flag updates to security-critical keys. SIEM rules apply baseline comparison to identify unexpected key updates and correlate with process context to determine legitimacy."
  core_concepts:
    - key: "metadata_modification"
      value: "Changes to registry key metadata including class information, last write timestamp, and other key attributes"
    - key: "comprehensive_coverage"
      value: "Catch-all detection for key modifications that do not match specific operation subtypes ensuring no activity gaps"
    - key: "baseline_deviation"
      value: "Comparing key update events against expected patterns to identify anomalous modifications in monitored registry paths"
    - key: "operation_classification"
      value: "Properly classifying registry operations to route events to appropriate detection rules and severity levels"

# ==== Section 6: Relations ====
relations:
  - type: "is_a"
    target: "DETECT-ENDPOINT-WINREGKEY-001"
    description: "Registry key update is a specific type of registry key operation event"
  - type: "requires"
    target: "DETECT-ENDPOINT-WIREKERE-001"
    description: "Update operations are typically preceded by read operations to assess current key state"

# ==== Section 7: Security Profile (optional) ====
security_profile:
  mitre_mapping:
    technique_id: "T1112"
    tactic:
      - "defense-evasion"
    sub_techniques: []
  defense_context:
    effectiveness: "medium"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  updated: "2026-02-10"
  version: "1.0"
  confidence: "medium"
  trust_source: "primary"
  sources:
    - "Sysmon Documentation - Registry Events"
    - "Microsoft Documentation - Registry Functions"
    - "MITRE ATT&CK T1112 - Modify Registry"
    - "Windows Security Event ID 4657 Reference"
  search_keywords:
    - "registry key update"
    - "registry key modification"
    - "registry key change"
    - "registry metadata update"
    - "Event ID 4657"
    - "registry key write"
    - "registry modification detection"
    - "registry key update event"
    - "registry change monitoring"
    - "registry baseline drift"
  embedding_text: "Windows registry key update event detection pattern captures general modification operations on registry keys including metadata changes, class information updates, and other key-level modifications not categorized as creation, deletion, or renaming. Provides comprehensive coverage of all registry key modification activity as a catch-all detection. Sources include Sysmon registry events, Windows Security Event ID 4657, and ETW providers. Maps to MITRE ATT&CK T1112 Modify Registry. Detection applies baseline comparison to identify anomalous key updates in monitored paths and correlates with process context to distinguish legitimate from suspicious registry modifications."
