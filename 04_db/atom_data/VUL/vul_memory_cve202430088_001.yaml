# GR Atom: CVE-2024-30088
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "VUL-MEMORY-CVE202430088-001"
  name: "CVE-2024-30088"
  normalized_name: "cve_2024_30088"
  aliases:
    - "Windows Kernel TOCTOU Race Condition"
    - "NtQueryInformationToken EoP"
    - "Windows Kernel Elevation of Privilege"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "vulnerability"
  abstraction_level: 1
  atom_tags:
    - PRIV
    - OVERFLOW
    - WINDOWS
    - OS

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L1", "L2"]
  target_zones: ["Z3", "Z4"]
  target_components:
    - "Windows kernel (ntoskrnl.exe)"
    - "Windows 10 and Windows 11"
    - "Windows Server 2016 through 2022"

# ==== Section 5: Definition ====
definition:
  what: >-
    CVE-2024-30088 is a privilege escalation vulnerability (CVSS 7.0) in the Windows
    kernel caused by a TOCTOU (Time-of-Check to Time-of-Use) race condition in the
    NtQueryInformationToken system call. The vulnerability allows a locally authenticated
    attacker to escalate privileges to SYSTEM by exploiting a race window where a kernel
    pointer is validated and then used without re-validation. Patched by Microsoft in
    June 2024, the vulnerability was subsequently added to CISA's Known Exploited
    Vulnerabilities catalog in October 2024 after confirmed exploitation in the wild,
    reportedly by the OilRig (APT34) threat group.
  why: >-
    CVE-2024-30088 is significant as a Windows kernel privilege escalation actively
    exploited by the Iranian APT group OilRig (APT34) in targeted espionage campaigns.
    TOCTOU race conditions in kernel code are notoriously difficult to detect through
    code review and static analysis, representing a persistent class of kernel
    vulnerabilities. The exploitation by a nation-state actor and subsequent CISA KEV
    listing demonstrates the continued strategic value of Windows kernel exploits for
    advanced threat actors targeting government and critical infrastructure.
  how: >-
    The exploit races against the kernel's NtQueryInformationToken handler. During a
    specific token query operation, the kernel reads a user-mode pointer, validates it,
    then uses it to write token information. The attacker creates multiple threads to
    modify the pointer between the validation and use, causing the kernel to write token
    data to an attacker-controlled kernel address. By carefully timing the race condition
    and targeting specific kernel structures, the attacker corrupts kernel objects to
    achieve arbitrary code execution with SYSTEM privileges. The race window is reliable
    enough for practical exploitation with multiple retry attempts.
  core_concepts:
    - key: "Kernel TOCTOU Race Condition"
      value: "Race window between pointer validation and use in NtQueryInformationToken enables kernel memory corruption"
    - key: "OilRig APT Exploitation"
      value: "Actively exploited by Iranian APT34/OilRig group in targeted espionage, added to CISA KEV catalog"
    - key: "Persistent Kernel Vulnerability Class"
      value: "TOCTOU race conditions in kernel system calls are difficult to detect and represent recurring vulnerability pattern"

# ==== Section 6: Relations ====
relations:
  - type: "instance_of"
    target: "VUL-MEMORY-MEMORY-001"
    description: "CVE-2024-30088 is a kernel memory corruption via TOCTOU race condition in Windows"
  - type: "enables"
    target: "VUL-MEMORY-CVE20167255-001"
    description: "Both are Windows kernel privilege escalation vulnerabilities exploited by APT groups"

# ==== Section 7: Security Profile ====
security_profile:
  mitre_mapping:
    technique_id: "T1068"
    tactic:
      - "Privilege Escalation"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  updated: "2026-02-11"
  version: "1.0"
  confidence: "high"
  trust_source: "authoritative"
  sources:
    - "Microsoft Security Update CVE-2024-30088"
    - "NVD Entry CVE-2024-30088 - CVSS 7.0"
    - "CISA Known Exploited Vulnerabilities Catalog"
    - "MITRE ATT&CK T1068 - Exploitation for Privilege Escalation"
    - "Trend Micro - OilRig exploitation analysis"
  search_keywords:
    - "CVE-2024-30088"
    - "Windows kernel"
    - "TOCTOU"
    - "race condition"
    - "privilege escalation"
    - "OilRig"
    - "APT34"
    - "NtQueryInformationToken"
  embedding_text: >-
    CVE-2024-30088 is a Windows kernel privilege escalation vulnerability with CVSS 7.0
    caused by a TOCTOU race condition in the NtQueryInformationToken system call. The race
    window between pointer validation and use allows kernel memory corruption, enabling
    SYSTEM-level privilege escalation. Actively exploited by the OilRig (APT34) Iranian
    threat group in targeted espionage campaigns, it was added to CISA's Known Exploited
    Vulnerabilities catalog. Patched by Microsoft in June 2024, it represents the
    persistent challenge of detecting and preventing race condition vulnerabilities in
    kernel code.
