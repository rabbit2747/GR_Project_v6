# GR Atom: Server Hello
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "PROTO-SECURITY-SERVHELL-001"
  name: "Server Hello"
  normalized_name: "server_hello"
  aliases:
    - "ServerHello"
    - "TLS ServerHello"
    - "ServerHello Message"
    - "Server Hello Message"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "protocol"
  abstraction_level: 2
  atom_tags:
    - TLS
    - CRYPTO
    - ENCRYPT

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L5", "L6"]
  target_zones: ["Z1", "Z2", "Z3"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    Server Hello (ServerHello) is a TLS handshake message sent by the server in response to the
    client's ClientHello, conveying the server's chosen cryptographic parameters for the TLS
    session. Defined in RFC 5246 Section 7.4.1.2 for TLS 1.2 and RFC 8446 Section 4.1.3 for
    TLS 1.3, the ServerHello contains the selected protocol version, a server random value,
    the chosen cipher suite, and in TLS 1.3, the server's key_share for the ephemeral
    Diffie-Hellman exchange. In TLS 1.3, the ServerHello is the last plaintext message sent by
    the server; all subsequent messages are encrypted under handshake traffic keys derived from
    the key exchange completed in ServerHello.
  why: >-
    The ServerHello message is the critical server response that resolves the cryptographic
    negotiation initiated by the ClientHello. Without ServerHello, the TLS handshake cannot
    proceed because the client has no knowledge of which cipher suite, protocol version, or key
    exchange parameters the server has selected from the options offered. In TLS 1.3, the
    ServerHello also completes the ephemeral key exchange by providing the server's key_share,
    enabling immediate derivation of handshake encryption keys. The server random value in
    ServerHello contributes unpredictability to key derivation, preventing replay attacks.
    TLS 1.3 uses a special sentinel value in the server random to signal HelloRetryRequest
    for cases requiring a different key share group.
  how: >-
    Upon receiving ClientHello, the server selects compatible parameters and constructs the
    ServerHello containing: (1) the selected protocol version (in TLS 1.3, this appears as
    TLS 1.2 for compatibility, with the actual version in the supported_versions extension);
    (2) a 32-byte server random; (3) a session ID (echoed from ClientHello in TLS 1.3 for
    middlebox compatibility); (4) the selected cipher suite from the client's offered list;
    (5) in TLS 1.2, the selected compression method; (6) extensions including key_share
    (TLS 1.3), supported_versions (TLS 1.3), and pre_shared_key (TLS 1.3). In TLS 1.3,
    only cryptographic parameters necessary for key derivation are in ServerHello; all other
    extensions move to the EncryptedExtensions message. After ServerHello, the server and
    client can derive handshake traffic keys and encrypt all subsequent handshake messages.
  core_concepts:
    - key: "Cipher Suite Selection"
      value: >-
        The server selects one cipher suite from the client's offered list based on server
        preference ordering and compatibility, determining the symmetric encryption algorithm,
        hash function, and in TLS 1.2, the key exchange method.
    - key: "Server Random"
      value: >-
        A 32-byte random value generated by the server that contributes to key derivation
        unpredictability and prevents replay attacks. TLS 1.3 uses specific byte patterns
        in the server random to signal downgrade protection.
    - key: "Key Share Exchange"
      value: >-
        In TLS 1.3, the ServerHello key_share extension contains the server's ephemeral
        public key, completing the Diffie-Hellman exchange and enabling immediate derivation
        of handshake encryption keys.
    - key: "Version Negotiation"
      value: >-
        TLS 1.3 negotiates the protocol version via the supported_versions extension rather
        than the legacy version field, which is fixed at TLS 1.2 (0x0303) for middlebox
        compatibility.

# ==== Section 6: Relations ====
relations:
  - type: "part_of"
    target: "PROTO-SECURITY-TLTRLASE-001"
    description: "Server Hello is a mandatory handshake message in all versions of the TLS protocol"
  - type: "enables"
    target: "PROTO-SECURITY-ENCREXTE-001"
    description: "ServerHello key exchange enables derivation of handshake keys needed to encrypt the EncryptedExtensions message"
  - type: "applies_to"
    target: "PROTO-SECURITY-TLS13-001"
    description: "In TLS 1.3, ServerHello completes the key exchange and is the last plaintext server message"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "RFC 8446 - The Transport Layer Security (TLS) Protocol Version 1.3, Section 4.1.3. IETF. https://datatracker.ietf.org/doc/html/rfc8446#section-4.1.3"
    - "RFC 5246 - The Transport Layer Security (TLS) Protocol Version 1.2, Section 7.4.1.2. IETF. https://datatracker.ietf.org/doc/html/rfc5246#section-7.4.1.2"
  search_keywords:
    - "ServerHello"
    - "server hello message"
    - "TLS server hello"
    - "cipher suite selection"
    - "server random"
    - "key_share extension"
    - "TLS handshake server response"
    - "supported_versions extension"
  embedding_text: >-
    Server Hello (ServerHello) is a TLS handshake message sent by the server in response to
    ClientHello, conveying the selected cryptographic parameters including protocol version,
    cipher suite, server random, and in TLS 1.3 the server's key_share for ephemeral
    Diffie-Hellman exchange. Defined in RFC 5246 for TLS 1.2 and RFC 8446 for TLS 1.3, it
    resolves the cryptographic negotiation by selecting compatible parameters from the client's
    offered options. In TLS 1.3, ServerHello is the last plaintext server message, with the
    key exchange enabling immediate derivation of handshake encryption keys for subsequent
    messages. The server random contributes 32 bytes of unpredictability to key derivation
    and carries downgrade protection sentinel values. TLS 1.3 places only cryptographic
    parameters in ServerHello while moving other extensions to the encrypted EncryptedExtensions
    message. Version negotiation uses the supported_versions extension while the legacy
    version field is fixed at 0x0303 for middlebox compatibility.
