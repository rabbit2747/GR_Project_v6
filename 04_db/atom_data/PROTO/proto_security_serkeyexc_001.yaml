# GR Atom: Server Key Exchange
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "PROTO-SECURITY-SERKEYEXC-001"
  name: "Server Key Exchange"
  normalized_name: "server_key_exchange"
  aliases:
    - "ServerKeyExchange"
    - "TLS ServerKeyExchange"
    - "SKE Message"
    - "Server Key Exchange Message"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "protocol"
  abstraction_level: 2
  atom_tags:
    - TLS
    - CRYPTO
    - ENCRYPT

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L5", "L6"]
  target_zones: ["Z1", "Z2", "Z3"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    Server Key Exchange (ServerKeyExchange) is a TLS handshake message defined in RFC 5246
    Section 7.4.3 that conveys the server's ephemeral key exchange parameters in TLS 1.2 and
    earlier when the server's certificate does not contain sufficient information for the client
    to complete the key exchange. This message is sent for cipher suites using ephemeral
    Diffie-Hellman (DHE) or ephemeral Elliptic Curve Diffie-Hellman (ECDHE) key exchange, where
    the server must provide its temporary DH/ECDH public key along with a digital signature
    authenticating the parameters. ServerKeyExchange does not exist in TLS 1.3, where the
    key_share extension in ServerHello replaces its function.
  why: >-
    For cipher suites providing forward secrecy (DHE_RSA, ECDHE_RSA, ECDHE_ECDSA), the server
    must generate ephemeral key exchange parameters for each connection rather than reusing
    static keys from its certificate. The ServerKeyExchange message delivers these ephemeral
    parameters to the client, signed with the server's long-term private key to authenticate
    them and prevent man-in-the-middle attacks. Without this message, the client would have no
    way to receive the server's ephemeral DH/ECDH public key needed to compute the shared
    pre-master secret. For non-ephemeral cipher suites like RSA key exchange, ServerKeyExchange
    is not sent because the client encrypts the pre-master secret directly to the server's
    RSA public key from its certificate.
  how: >-
    The ServerKeyExchange message contains the server's ephemeral key exchange parameters and
    a signature over those parameters. For DHE suites, it includes the DH prime (p), generator
    (g), and the server's ephemeral DH public value (Ys). For ECDHE suites, it includes the
    named curve identifier and the server's ephemeral ECDH public point. The server then signs
    a hash of the client random, server random, and key exchange parameters using its long-term
    private key (RSA or ECDSA, matching the cipher suite). The client verifies this signature
    using the server's certificate public key to authenticate the ephemeral parameters, then
    uses the parameters to compute its own DH/ECDH key pair and derive the shared pre-master
    secret. In TLS 1.3, the key_share extension in ServerHello carries the server's ephemeral
    key directly, and authentication is provided by the CertificateVerify message over the
    entire handshake transcript rather than just the key exchange parameters.
  core_concepts:
    - key: "Ephemeral Key Delivery"
      value: >-
        ServerKeyExchange delivers the server's temporary DH or ECDH public key for cipher
        suites that provide forward secrecy, ensuring each connection uses unique key material.
    - key: "Parameter Authentication"
      value: >-
        The server signs the ephemeral key exchange parameters with its long-term private
        key, allowing the client to verify the parameters are authentic and not injected
        by a man-in-the-middle attacker.
    - key: "Forward Secrecy Enablement"
      value: >-
        By providing ephemeral rather than static key exchange parameters, ServerKeyExchange
        enables Perfect Forward Secrecy where compromise of the server's long-term key
        does not compromise past session keys.
    - key: "Replaced by key_share in TLS 1.3"
      value: >-
        TLS 1.3 moved ephemeral key exchange into the ServerHello key_share extension and
        authentication into CertificateVerify, eliminating the separate ServerKeyExchange
        message.

# ==== Section 6: Relations ====
relations:
  - type: "part_of"
    target: "PROTO-SECURITY-TLS12-001"
    description: "Server Key Exchange is a conditional handshake message in TLS 1.2 for ephemeral key exchange cipher suites"
  - type: "part_of"
    target: "PROTO-SECURITY-TLTRLASE-001"
    description: "Server Key Exchange is part of the TLS handshake protocol for DHE and ECDHE cipher suites"
  - type: "requires"
    target: "PROTO-SECURITY-SERVHELL-001"
    description: "Server Key Exchange follows Server Hello and is sent before Server Hello Done"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "RFC 5246 - The Transport Layer Security (TLS) Protocol Version 1.2, Section 7.4.3. IETF. https://datatracker.ietf.org/doc/html/rfc5246#section-7.4.3"
    - "RFC 4492 - Elliptic Curve Cryptography (ECC) Cipher Suites for TLS. IETF. https://datatracker.ietf.org/doc/html/rfc4492"
  search_keywords:
    - "ServerKeyExchange"
    - "server key exchange"
    - "ephemeral Diffie-Hellman"
    - "ECDHE key exchange"
    - "DHE key exchange"
    - "forward secrecy TLS"
    - "TLS ephemeral parameters"
    - "RFC 5246 section 7.4.3"
  embedding_text: >-
    Server Key Exchange (ServerKeyExchange) is a TLS handshake message defined in RFC 5246
    that delivers the server's ephemeral Diffie-Hellman or ECDH key exchange parameters in
    TLS 1.2 for cipher suites providing forward secrecy. For DHE suites it contains the DH
    prime, generator, and server public value; for ECDHE it contains the named curve and
    server public point. The server signs these parameters with its long-term private key to
    authenticate them against man-in-the-middle attacks. The client verifies the signature
    using the server certificate's public key, then computes its own key pair to derive the
    shared pre-master secret. ServerKeyExchange is not sent for RSA key exchange where the
    client encrypts the pre-master secret directly to the certificate's RSA key. TLS 1.3
    eliminated this message by moving ephemeral key exchange into the ServerHello key_share
    extension and authentication into CertificateVerify over the complete handshake transcript.
    The message enables Perfect Forward Secrecy by ensuring each connection uses unique
    ephemeral key material.
