# GR Atom: DNS Cookie
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "PROTO-NAMING-DNSCOOK-001"
  name: "DNS Cookie"
  normalized_name: "dns_cookie"
  aliases:
    - "DNS Cookies"
    - "DNS Server Cookie"
    - "DNS Client Cookie"
    - "RFC 7873"
    - "EDNS Cookie Option"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "protocol"
  abstraction_level: 2
  atom_tags:
    - DNS
    - NETWORK

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L7"]
  target_zones: ["Z2", "Z3", "Z4"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    DNS Cookie is a lightweight security mechanism defined in RFC 7873 that provides limited
    protection against DNS forgery and amplification attacks through a client-server cookie
    exchange carried as an EDNS0 option (option code 10). The client cookie is an 8-byte value
    computed by the client using a secret, the server IP, and optionally the client IP. The
    server cookie is an 8-32 byte value generated by the server using its secret and the client
    cookie. DNS Cookies provide a low-cost mechanism to verify that a DNS response comes from the
    legitimate server and that the client's source IP is not spoofed, without the computational
    overhead of DNSSEC or TLS.
  why: >-
    DNS operates primarily over UDP, which is inherently vulnerable to source IP spoofing.
    Attackers exploit this to forge DNS responses (cache poisoning) and to use DNS servers as
    amplifiers in DDoS attacks by sending queries with spoofed source addresses. DNS Cookies
    address both threats: by requiring a valid server cookie in responses, clients can detect
    forged replies from off-path attackers; by requiring a valid client cookie in queries,
    servers can distinguish legitimate queries from spoofed ones and refuse amplification.
    DNS Cookies complement DNSSEC (which validates data authenticity but not source) and DNS
    over HTTPS/TLS (which is heavier weight). They are particularly valuable as a first line
    of defense that can be deployed incrementally without requiring full DNSSEC or encrypted
    DNS deployment.
  how: >-
    DNS Cookie operation follows a handshake-like exchange: (1) the client generates an 8-byte
    client cookie from a per-server secret and the server's IP address, included in the EDNS0
    OPT record of queries; (2) on first contact, the server generates a server cookie using its
    secret, the client cookie, the client's IP, and a timestamp, returning both cookies in the
    response; (3) the client caches the server cookie and includes it in subsequent queries;
    (4) the server validates both the client cookie (verifying the client is not spoofing) and
    the server cookie (confirming the client received a previous legitimate response); (5) queries
    with invalid cookies may receive truncated responses (TC bit set) forcing TCP retry, or
    BADCOOKIE (extended RCODE 23) responses; (6) server cookies include timestamps enabling
    expiration and rotation without client coordination; (7) implementation follows RFC 9018
    for interoperable server cookie computation using SipHash-2-4.
  core_concepts:
    - key: "Client Cookie"
      value: >-
        An 8-byte pseudorandom value generated by the DNS client using a secret key and the
        server's IP address. The client cookie proves the query originates from a client that
        previously communicated with the server, providing source IP verification.
    - key: "Server Cookie"
      value: >-
        An 8-32 byte value generated by the DNS server incorporating its secret, the client
        cookie, client IP, and a timestamp. The server cookie enables the client to validate
        that responses originate from the legitimate server rather than an off-path forger.
    - key: "BADCOOKIE Response"
      value: >-
        Extended DNS RCODE 23 returned by servers when a query contains an invalid or expired
        server cookie, prompting the client to retry with a fresh cookie obtained from the
        response, completing the cookie re-establishment process.
    - key: "Anti-Amplification"
      value: >-
        DNS Cookie validation allows servers to distinguish legitimate queries from spoofed
        ones, enabling selective response limitation (TC bit forcing TCP, or reduced response
        size) for unverified sources, significantly reducing DNS amplification effectiveness.

# ==== Section 6: Relations ====
relations:
  - type: "part_of"
    target: "PROTO-NAMING-DNSDOMNAM-001"
    description: "DNS Cookies are an EDNS0 extension within the DNS protocol providing source verification"
  - type: "requires"
    target: "PROTO-TRANSPORT-UDP-001"
    description: "DNS Cookies specifically address UDP-based DNS vulnerabilities including source spoofing and amplification"
  - type: "enables"
    target: "PROTO-NAMING-DNEDCLSU-001"
    description: "DNS Cookies provide source verification that complements EDNS Client Subnet privacy considerations"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "RFC 7873 - Domain Name System (DNS) Cookies (May 2016). IETF. https://datatracker.ietf.org/doc/html/rfc7873"
    - "RFC 9018 - Interoperable Domain Name System (DNS) Server Cookies (April 2021). IETF. https://datatracker.ietf.org/doc/html/rfc9018"
    - "RFC 6891 - Extension Mechanisms for DNS (EDNS(0)) (April 2013). IETF. https://datatracker.ietf.org/doc/html/rfc6891"
  search_keywords:
    - "DNS cookies"
    - "RFC 7873"
    - "DNS forgery prevention"
    - "DNS amplification mitigation"
    - "EDNS cookie"
    - "DNS source verification"
    - "BADCOOKIE"
    - "DNS anti-spoofing"
    - "server cookie"
    - "client cookie"
    - "RFC 9018"
  embedding_text: >-
    DNS Cookie is a security mechanism defined in RFC 7873 providing lightweight protection
    against DNS forgery and amplification attacks through client-server cookie exchange in EDNS0
    options. The client generates an 8-byte cookie using a secret and server IP; the server
    generates a server cookie incorporating its secret, client cookie, client IP, and timestamp.
    DNS Cookies verify source IP legitimacy for both clients (detecting forged responses) and
    servers (detecting spoofed queries used in amplification attacks). Invalid cookies trigger
    BADCOOKIE responses or TC-bit truncation forcing TCP retry. RFC 9018 standardizes
    interoperable server cookie computation using SipHash-2-4. DNS Cookies complement DNSSEC
    and encrypted DNS as a low-cost, incrementally deployable first line of defense against
    UDP-based DNS attacks.
