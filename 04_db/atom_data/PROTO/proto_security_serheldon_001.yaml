# GR Atom: Server Hello Done
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "PROTO-SECURITY-SERHELDON-001"
  name: "Server Hello Done"
  normalized_name: "server_hello_done"
  aliases:
    - "ServerHelloDone"
    - "TLS ServerHelloDone"
    - "Server Hello Done Message"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "protocol"
  abstraction_level: 2
  atom_tags:
    - TLS
    - CRYPTO

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L5", "L6"]
  target_zones: ["Z1", "Z2", "Z3"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    Server Hello Done (ServerHelloDone) is a TLS handshake message defined in RFC 5246 Section
    7.4.5 that signals the completion of the server's hello message phase in TLS 1.2 and
    earlier versions. It is a zero-length message (containing no data beyond the handshake
    header) that serves as a delimiter indicating the server has finished sending its initial
    handshake messages (ServerHello, Certificate, ServerKeyExchange, CertificateRequest) and
    is waiting for the client to respond. This message does not exist in TLS 1.3, which
    restructured the handshake to eliminate the need for explicit phase delimiters.
  why: >-
    In TLS 1.2, the server's initial handshake flight can contain a variable number of messages
    depending on the negotiated cipher suite and authentication requirements: Certificate is
    present for most cipher suites, ServerKeyExchange is present for DHE/ECDHE suites, and
    CertificateRequest is present when client authentication is required. The client cannot
    determine which combination of messages to expect without parsing each one. ServerHelloDone
    provides an unambiguous end-of-flight signal, allowing the client to know that all server
    hello-phase messages have been received and it should begin its response. Without this
    delimiter, the client would have difficulty determining when the server's initial flight
    is complete, particularly for cipher suites with optional messages.
  how: >-
    After sending all applicable hello-phase messages (ServerHello, optionally Certificate,
    optionally ServerKeyExchange, optionally CertificateRequest), the server sends
    ServerHelloDone which consists solely of a handshake header with type 14 and zero-length
    body. Upon receiving ServerHelloDone, the client processes all accumulated server hello
    messages and begins its response: sending Certificate (if requested), ClientKeyExchange,
    CertificateVerify (if client certificate was sent), ChangeCipherSpec, and Finished. In
    TLS 1.3, this message was eliminated because the redesigned handshake uses a single
    server flight (ServerHello followed by encrypted messages) where the Finished message
    implicitly marks the end of the server's handshake.
  core_concepts:
    - key: "Zero-Length Delimiter"
      value: >-
        ServerHelloDone contains no data fields; it is purely a structural message with
        handshake type 14 and length 0, serving only as a phase boundary indicator.
    - key: "Variable Flight Termination"
      value: >-
        The message solves the problem of variable-length server flights where the number
        of messages depends on cipher suite selection and client authentication requirements.
    - key: "Eliminated in TLS 1.3"
      value: >-
        TLS 1.3 removed ServerHelloDone by restructuring the handshake so that the server's
        Finished message implicitly marks the end of the server's handshake messages.

# ==== Section 6: Relations ====
relations:
  - type: "part_of"
    target: "PROTO-SECURITY-TLS12-001"
    description: "Server Hello Done is a handshake message used in TLS 1.2 to delimit the server's hello phase"
  - type: "part_of"
    target: "PROTO-SECURITY-TLTRLASE-001"
    description: "Server Hello Done is part of the TLS handshake protocol in pre-1.3 versions"
  - type: "requires"
    target: "PROTO-SECURITY-SERVHELL-001"
    description: "Server Hello Done always follows a Server Hello message and optionally other server hello-phase messages"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "RFC 5246 - The Transport Layer Security (TLS) Protocol Version 1.2, Section 7.4.5. IETF. https://datatracker.ietf.org/doc/html/rfc5246#section-7.4.5"
    - "RFC 8446 - The Transport Layer Security (TLS) Protocol Version 1.3. IETF. https://datatracker.ietf.org/doc/html/rfc8446"
  search_keywords:
    - "ServerHelloDone"
    - "server hello done"
    - "TLS handshake delimiter"
    - "handshake type 14"
    - "server flight termination"
    - "TLS 1.2 handshake"
    - "RFC 5246 section 7.4.5"
  embedding_text: >-
    Server Hello Done (ServerHelloDone) is a zero-length TLS handshake message defined in
    RFC 5246 that signals the completion of the server's hello message phase in TLS 1.2 and
    earlier. With handshake type 14, it contains no data and serves purely as a delimiter
    indicating the server has finished sending its initial messages including ServerHello,
    Certificate, ServerKeyExchange, and CertificateRequest. The client needs this signal
    because the server's hello flight contains a variable number of messages depending on
    cipher suite and authentication requirements. Upon receiving ServerHelloDone, the client
    begins its response with ClientKeyExchange and related messages. TLS 1.3 eliminated
    ServerHelloDone by restructuring the handshake where the server's Finished message
    implicitly marks the end of the server's handshake flight, removing the need for an
    explicit phase boundary delimiter.
