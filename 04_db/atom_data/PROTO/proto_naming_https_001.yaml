# GR Atom: DNS Over HTTPS
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "PROTO-NAMING-HTTPS-001"
  name: "DNS Over HTTPS"
  normalized_name: "dns_over_https"
  aliases:
    - "DoH"
    - "DNS-over-HTTPS"
    - "RFC 8484"
    - "Encrypted DNS"
    - "HTTPS DNS"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "protocol"
  abstraction_level: 2
  atom_tags:
    - DNS
    - HTTP
    - TLS

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L6", "L7"]
  target_zones: ["Z2", "Z3", "Z4", "Z5"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    DNS over HTTPS (DoH) is a protocol defined in RFC 8484 that encrypts DNS queries and
    responses within HTTPS connections to port 443. DoH sends DNS wire-format messages as HTTP
    POST or GET requests to a DoH server endpoint (typically /dns-query), with responses returned
    as application/dns-message content type. By encapsulating DNS within standard HTTPS traffic,
    DoH provides confidentiality and integrity for DNS resolution while making DNS traffic
    indistinguishable from regular web browsing to network observers. Major browsers including
    Chrome, Firefox, Edge, and Safari support DoH natively.
  why: >-
    Traditional DNS operates in plaintext over UDP port 53, exposing every DNS query to network
    operators, ISPs, and any entity capable of observing network traffic. This enables mass
    surveillance of browsing habits, DNS-based censorship through query interception and
    modification, and man-in-the-middle attacks on DNS responses. DoH addresses these threats
    by encrypting DNS traffic within TLS/HTTPS. However, DoH is controversial in enterprise
    security because it bypasses traditional DNS monitoring and filtering infrastructure: network
    security teams rely on DNS logs for threat detection (DGA detection, C2 identification,
    data exfiltration monitoring), and DoH routes DNS through browser-configured HTTPS resolvers
    that may circumvent enterprise DNS policies. Malware has adopted DoH for C2 communications
    to evade detection. The tension between user privacy and enterprise security visibility
    makes DoH a significant network security policy decision.
  how: >-
    DoH operates through standard HTTPS mechanics: (1) the client establishes a TLS 1.3
    connection to the DoH resolver endpoint (e.g., https://dns.cloudflare.com/dns-query or
    https://dns.google/dns-query); (2) DNS queries are encoded in wire format (RFC 1035) and
    sent as HTTP POST requests with content-type application/dns-message, or as GET requests
    with base64url-encoded query in the dns parameter; (3) the resolver processes the query
    through standard recursive resolution; (4) the response is returned as an HTTP response
    with the same content type; (5) HTTP/2 multiplexing enables multiple concurrent queries
    over a single TCP connection, reducing connection overhead. Enterprise controls include:
    blocking known DoH resolver IPs and hostnames, deploying internal DoH resolvers that enforce
    organizational DNS policies, using network-level TLS inspection (with appropriate policy
    and certificate management), configuring browsers via Group Policy to use enterprise DoH
    endpoints, and monitoring for DoH-based C2 through TLS fingerprinting and traffic analysis.
  core_concepts:
    - key: "DNS Privacy"
      value: >-
        DoH prevents network observers from viewing DNS query contents, protecting users from
        ISP surveillance, DNS-based censorship, and man-in-the-middle manipulation of DNS
        responses. DNS traffic becomes indistinguishable from regular HTTPS web browsing.
    - key: "Enterprise DNS Bypass"
      value: >-
        DoH can circumvent enterprise DNS monitoring and policy enforcement when browsers
        route DNS through external resolvers, bypassing split-horizon DNS, content filtering,
        threat detection based on DNS logs, and regulatory DNS compliance requirements.
    - key: "Malware DoH Abuse"
      value: >-
        Threat actors use DoH for command and control communications, DNS-based data
        exfiltration, and domain resolution that evades traditional DNS monitoring. DoH
        makes these communications appear as normal HTTPS traffic to network security tools.
    - key: "DoH vs DoT"
      value: >-
        DNS over TLS (DoT, RFC 7858) encrypts DNS on port 853, making it identifiable and
        blockable as DNS traffic. DoH on port 443 is indistinguishable from web traffic,
        providing stronger censorship resistance but weaker enterprise controllability.

# ==== Section 6: Relations ====
relations:
  - type: "part_of"
    target: "PROTO-NAMING-DNSDOMNAM-001"
    description: "DNS over HTTPS is an encrypted transport mechanism for the DNS protocol"
  - type: "requires"
    target: "PROTO-TRANSPORT-TCPTRAN-001"
    description: "DoH requires TCP-based HTTPS connections for DNS query transport and encryption"
  - type: "enables"
    target: "PROTO-NAMING-DNSHTTREC-001"
    description: "DoH enables secure distribution of HTTPS records including ECH keys through encrypted DNS channels"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "RFC 8484 - DNS Queries over HTTPS (DoH) (October 2018). IETF. https://datatracker.ietf.org/doc/html/rfc8484"
    - "RFC 7858 - Specification for DNS over Transport Layer Security (DoT) (May 2016). IETF. https://datatracker.ietf.org/doc/html/rfc7858"
    - "CISA Encrypted DNS Implementation Guidance. Cybersecurity and Infrastructure Security Agency."
    - "Mozilla Wiki - Trusted Recursive Resolver (TRR). https://wiki.mozilla.org/Trusted_Recursive_Resolver"
  search_keywords:
    - "DNS over HTTPS"
    - "DoH"
    - "RFC 8484"
    - "encrypted DNS"
    - "DNS privacy"
    - "DNS censorship resistance"
    - "enterprise DNS bypass"
    - "DoH malware"
    - "DNS over TLS"
    - "DoT"
    - "DNS monitoring"
    - "Cloudflare DNS"
    - "Google DNS"
  embedding_text: >-
    DNS over HTTPS (DoH, RFC 8484) encrypts DNS queries within HTTPS connections on port 443,
    providing confidentiality and making DNS traffic indistinguishable from web browsing. DoH
    protects users from ISP surveillance, DNS censorship, and man-in-the-middle attacks on DNS
    responses. However, it introduces enterprise security challenges by bypassing DNS monitoring,
    content filtering, and policy enforcement when browsers use external resolvers. Malware
    exploits DoH for covert C2 communications that evade detection. Enterprise controls include
    internal DoH resolvers enforcing organizational policies, blocking external DoH endpoints,
    and browser policy management. The tension between user privacy and enterprise security
    visibility makes DoH a critical DNS policy decision. DoH differs from DoT (port 853) in
    being unblockable without blocking all HTTPS traffic.
