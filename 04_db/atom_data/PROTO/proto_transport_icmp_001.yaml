# GR Atom: ICMP
# Schema: atom_schema.yaml v5.1
# Status: enriched

# ==== Section 1: Identity ====
identity:
  id: "PROTO-TRANSPORT-ICMP-001"
  name: "ICMP"
  normalized_name: "icmp"
  aliases:
    - "Internet Control Message Protocol"
    - "ICMP Protocol"
    - "ICMPv4"
    - "Ping Protocol"
    - "ICMP Echo"

# ==== Section 2: Classification ====
classification:
  is_infrastructure: false
  type: "protocol"
  abstraction_level: 2
  atom_tags:
    - NETWORK
    - SNMP

# ==== Section 4: Scope (non-INFRA only) ====
scope:
  target_layers: ["L3"]
  target_zones: ["Z2", "Z3", "Z4", "Z5"]
  target_components: []

# ==== Section 5: Definition ====
definition:
  what: >-
    ICMP (Internet Control Message Protocol) is a network-layer protocol defined in RFC 792 that
    provides error reporting and diagnostic functions for IPv4 networks. ICMP messages are
    encapsulated within IP datagrams using IP protocol number 1. The protocol supports operational
    message types including Echo Request/Reply (ping, types 8/0), Destination Unreachable (type 3),
    Time Exceeded (type 11, used by traceroute), Redirect (type 5), and Source Quench (deprecated,
    type 4). ICMP is essential for network troubleshooting, path MTU discovery, and router
    signaling but carries no application data and provides no transport-layer services.
  why: >-
    ICMP is a dual-use protocol that is both essential for network operations and a significant
    attack vector. From a defensive perspective, ICMP enables network diagnostics (ping,
    traceroute), path MTU discovery preventing fragmentation issues, and router-to-host signaling.
    From an offensive perspective, ICMP enables network reconnaissance through ping sweeps and
    traceroute mapping, covert channels through ICMP tunneling (embedding data in echo payloads),
    denial of service through ping floods and smurf amplification attacks, and host/OS fingerprinting
    through ICMP response behavior analysis. ICMP redirect messages can manipulate host routing
    tables. Overly permissive ICMP filtering exposes networks to reconnaissance, while overly
    restrictive filtering breaks path MTU discovery and diagnostic capabilities. Proper ICMP
    policy requires understanding which message types to permit at each network boundary.
  how: >-
    ICMP operates as an integral part of the IP layer: (1) Error messages are generated by routers
    and hosts when IP packets cannot be delivered, with the original packet header included for
    identification; (2) Echo Request (type 8) and Echo Reply (type 0) implement the ping utility,
    measuring round-trip time and packet loss; (3) Time Exceeded (type 11, code 0) is returned by
    routers when TTL reaches zero, enabling traceroute to map network paths; (4) Destination
    Unreachable (type 3) with various codes indicates why delivery failed (network/host/port/protocol
    unreachable, fragmentation needed); (5) Redirect (type 5) instructs hosts to update routing
    tables. Security controls include: rate-limiting ICMP responses to prevent amplification, blocking
    ICMP redirects at host and network level, permitting only essential types (echo, unreachable,
    time-exceeded) at boundaries, implementing ICMP inspection in stateful firewalls, and detecting
    ICMP tunneling through payload analysis and traffic anomaly detection.
  core_concepts:
    - key: "ICMP Echo (Ping)"
      value: >-
        The request-reply mechanism (types 8 and 0) used to test host reachability and measure
        round-trip latency. Ping is the most widely used network diagnostic tool but also
        enables host discovery scanning and can be used for ICMP tunneling attacks.
    - key: "ICMP Tunneling"
      value: >-
        A covert communication technique that embeds arbitrary data within ICMP echo request
        and reply payloads, bypassing firewalls that permit ICMP but do not inspect payload
        content. Tools like icmpsh and ptunnel implement ICMP-based covert channels.
    - key: "Path MTU Discovery"
      value: >-
        A mechanism using ICMP Destination Unreachable (type 3, code 4 - fragmentation needed)
        messages to determine the maximum transmission unit along a network path, preventing
        IP fragmentation and the performance issues it causes.
    - key: "ICMP Rate Limiting"
      value: >-
        A security control that restricts the rate of ICMP message generation and forwarding
        to prevent amplification attacks, reduce information leakage from error messages, and
        mitigate denial of service while maintaining essential diagnostic functionality.

# ==== Section 6: Relations ====
relations:
  - type: "is_a"
    target: "PROTO-TRANSPORT-001"
    description: "ICMP is a network-layer control protocol within the transport and control protocol family"
  - type: "enables"
    target: "PROTO-TRANSPORT-ICMPV6-001"
    description: "ICMP for IPv4 is the predecessor to ICMPv6, which extends functionality with neighbor discovery for IPv6 networks"
  - type: "requires"
    target: "PROTO-ROUTING-ARP-001"
    description: "ICMP messages on local segments require ARP for MAC address resolution to deliver IP-encapsulated ICMP packets"

# ==== Section 8: Metadata ====
metadata:
  created: "2026-02-06"
  version: "1.0"
  confidence: "high"
  trust_source: "primary"
  sources:
    - "RFC 792 - Internet Control Message Protocol (September 1981). IETF. https://datatracker.ietf.org/doc/html/rfc792"
    - "RFC 1122 - Requirements for Internet Hosts - Communication Layers (October 1989). IETF. https://datatracker.ietf.org/doc/html/rfc1122"
    - "RFC 1191 - Path MTU Discovery (November 1990). IETF. https://datatracker.ietf.org/doc/html/rfc1191"
    - "MITRE ATT&CK T1095 - Non-Application Layer Protocol. https://attack.mitre.org/techniques/T1095/"
  search_keywords:
    - "ICMP"
    - "internet control message protocol"
    - "ping protocol"
    - "ICMP tunneling"
    - "ping sweep"
    - "traceroute"
    - "ICMP flood"
    - "smurf attack"
    - "path MTU discovery"
    - "ICMP redirect"
    - "RFC 792"
    - "network reconnaissance"
  embedding_text: >-
    ICMP (Internet Control Message Protocol) is a network-layer protocol defined in RFC 792
    providing error reporting and diagnostics for IPv4 networks. It supports Echo Request/Reply
    (ping), Destination Unreachable, Time Exceeded (traceroute), and Redirect messages. ICMP is
    essential for network troubleshooting and path MTU discovery but presents significant security
    concerns including network reconnaissance via ping sweeps and traceroute, covert channels via
    ICMP tunneling, denial of service through ping floods and smurf amplification, and routing
    manipulation via ICMP redirects. Security controls include rate limiting, blocking redirects,
    permitting only essential types at boundaries, stateful ICMP inspection, and payload analysis
    for tunnel detection. Proper ICMP policy balances operational necessity against information
    leakage and attack surface exposure at each network boundary.
