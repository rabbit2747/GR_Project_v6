# CVE-GR 좌표 매핑 가이드 v1.0

> **목적**: CVE 취약점을 GR Framework 3차원 좌표로 매핑하는 규칙 정의
> **용도**: AI Classifier 시스템 프롬프트, 수동 매핑 가이드

---

## 1. 매핑 프로세스 개요

### 1.1 입력 → 출력

```
┌─────────────────────────────────────────────────────────────────────┐
│  입력: CVE 데이터                                                   │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │ • CVE ID (CVE-2021-44228)                                     │ │
│  │ • 설명 (Description)                                          │ │
│  │ • CWE ID (CWE-502)                                            │ │
│  │ • CVSS Score (10.0)                                           │ │
│  │ • 영향받는 제품 (CPE)                                          │ │
│  │ • 참조 URL                                                    │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                              │                                      │
│                              ▼                                      │
│  출력: GR 좌표                                                      │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │ • Layer: [L1~L7, CrossLayer]                                  │ │
│  │ • Zone: [Zone_0A, Zone_0B, Zone_1~Zone_5]                     │ │
│  │ • Tags: [Primary Tag, Detection Tags[], Mitigation Tags[]]   │ │
│  │ • Confidence Score: [0.0 ~ 1.0]                               │ │
│  └───────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 매핑 우선순위

1. **CWE 기반 매핑**: CWE ID가 있으면 기존 CWE-GR 매핑 참조
2. **키워드 기반 매핑**: 설명에서 키워드 추출하여 Layer/Zone/Tag 결정
3. **제품 기반 매핑**: CPE 정보로 영향받는 계층 추정
4. **유사 CVE 참조**: 유사한 CVE의 기존 매핑 참조

---

## 2. Layer 매핑 규칙

### 2.1 Layer 정의

| Layer | 명칭 | 대표 컴포넌트 |
|-------|------|--------------|
| L1 | Physical | 데이터센터, 서버 하드웨어, 스토리지 |
| L2 | Network | 로드밸런서, 방화벽, WAF, VPN, CDN |
| L3 | Compute | 클라우드 플랫폼, VM, 하이퍼바이저 |
| L4 | Platform | CI/CD, IaC, GitOps, Container Registry |
| L5 | Data | 관계형DB, NoSQL, 캐시, 오브젝트 스토리지 |
| L6 | Runtime | 컨테이너, 오케스트레이션, 메시지 큐 |
| L7 | Application | 프론트엔드, 백엔드 API, API 게이트웨이 |
| CrossLayer | 관리 계층 | 모니터링, IAM, SIEM, ITSM |

### 2.2 Layer 판단 키워드

```yaml
L1_Physical:
  keywords:
    - "hardware", "firmware", "bios", "uefi", "chip", "processor"
    - "physical", "power", "cooling", "rack"
  cpe_patterns:
    - "cpe:2.3:h:*"  # 하드웨어 CPE

L2_Network:
  keywords:
    - "firewall", "router", "switch", "load balancer", "waf"
    - "vpn", "cdn", "dns", "proxy", "ssl", "tls", "certificate"
    - "network", "packet", "traffic", "ddos"
  cpe_patterns:
    - "*firewall*", "*router*", "*switch*"

L3_Compute:
  keywords:
    - "hypervisor", "vmware", "virtualbox", "kvm", "xen"
    - "ec2", "azure vm", "gcp compute", "cloud"
    - "virtual machine", "vm escape"
  cpe_patterns:
    - "*vmware*", "*virtualbox*", "*hypervisor*"

L4_Platform:
  keywords:
    - "jenkins", "gitlab", "github actions", "circleci"
    - "terraform", "ansible", "kubernetes config"
    - "docker registry", "container registry", "helm"
  cpe_patterns:
    - "*jenkins*", "*gitlab*", "*terraform*"

L5_Data:
  keywords:
    - "database", "mysql", "postgresql", "mongodb", "redis"
    - "sql injection", "data leak", "backup", "storage"
    - "s3", "blob storage", "data warehouse"
  cpe_patterns:
    - "*mysql*", "*postgresql*", "*mongodb*", "*redis*"

L6_Runtime:
  keywords:
    - "container", "docker", "kubernetes", "k8s", "pod"
    - "service mesh", "istio", "envoy", "message queue"
    - "rabbitmq", "kafka", "runtime"
  cpe_patterns:
    - "*docker*", "*kubernetes*", "*kafka*"

L7_Application:
  keywords:
    - "web application", "api", "rest", "graphql", "frontend"
    - "react", "angular", "vue", "spring", "django", "express"
    - "xss", "csrf", "ssrf", "injection", "authentication"
    - "log4j", "struts", "jackson", "serialization"
  cpe_patterns:
    - "*spring*", "*django*", "*express*", "*log4j*"

CrossLayer:
  keywords:
    - "monitoring", "logging", "metrics", "iam", "sso"
    - "siem", "splunk", "elk", "prometheus", "grafana"
    - "secrets", "vault", "credential"
```

### 2.3 멀티 Layer 매핑

일부 취약점은 여러 Layer에 영향을 미칩니다:

| 패턴 | Layers | 예시 |
|------|--------|------|
| 공급망 공격 | L4, L6, L7 | SolarWinds, log4j |
| 컨테이너 탈출 | L3, L6 | CVE-2019-5736 |
| 네트워크 레벨 RCE | L2, L7 | ProxyLogon |
| 데이터베이스 연동 취약점 | L5, L7 | SQL Injection |

---

## 3. Zone 매핑 규칙

### 3.1 Zone 정의

| Zone | 명칭 | 신뢰 수준 | 대표 영역 |
|------|------|----------|----------|
| Zone_0A | Untrusted External | 신뢰 없음 | 인터넷, 익명 사용자 |
| Zone_0B | Trusted Partner | 제한적 신뢰 | B2B 파트너, API 연동 |
| Zone_1 | Perimeter | 경계 보안 | DMZ, WAF, 로드밸런서 |
| Zone_2 | Application | 애플리케이션 영역 | 웹서버, API 서버 |
| Zone_3 | Data | 데이터 영역 | DB 서버, 스토리지 |
| Zone_4 | Management | 관리 영역 | 관리 콘솔, 모니터링 |
| Zone_5 | Endpoint | 엔드포인트 | 클라이언트, 사용자 디바이스 |

### 3.2 Zone 판단 기준

```yaml
Zone_0A_Untrusted:
  indicators:
    - "공격자가 인터넷에서 직접 접근 가능"
    - "인증 없이 악용 가능"
    - "anonymous", "unauthenticated", "remote"
  attack_vector:
    - "NETWORK" (CVSS AV:N)
    - "external attacker"

Zone_0B_Partner:
  indicators:
    - "B2B API", "partner API", "federated"
    - "외부 시스템 연동", "third-party integration"

Zone_1_Perimeter:
  indicators:
    - "방화벽", "WAF", "로드밸런서", "프록시"
    - "DMZ", "edge", "ingress"
  components:
    - "nginx", "haproxy", "f5", "cloudflare"

Zone_2_Application:
  indicators:
    - "웹 애플리케이션", "API 서버", "백엔드"
    - "authentication bypass", "authorization"
    - "코드 실행", "RCE", "injection"
  components:
    - "tomcat", "apache", "iis", "application server"

Zone_3_Data:
  indicators:
    - "데이터베이스", "스토리지", "캐시"
    - "data exfiltration", "data leak"
    - "sql injection 결과", "데이터 접근"
  components:
    - "mysql", "postgresql", "mongodb", "s3"

Zone_4_Management:
  indicators:
    - "관리 콘솔", "admin panel", "management interface"
    - "CI/CD", "deployment", "configuration"
    - "모니터링", "로깅", "alerting"
  components:
    - "jenkins", "grafana", "kibana", "admin"

Zone_5_Endpoint:
  indicators:
    - "클라이언트", "브라우저", "모바일 앱"
    - "사용자 디바이스", "workstation"
    - "client-side", "local"
```

### 3.3 멀티 Zone 매핑

| 패턴 | Zones | 예시 |
|------|-------|------|
| 웹 취약점 + 데이터 유출 | Zone_2, Zone_3 | SQL Injection |
| 인증 우회 + 관리자 접근 | Zone_2, Zone_4 | Auth Bypass |
| 클라이언트 + 서버 공격 | Zone_5, Zone_2 | XSS → Session Hijacking |

---

## 4. Tag 매핑 규칙

### 4.1 Tag 체계 (10-Domain Model)

| Domain | 코드 | 설명 |
|--------|------|------|
| Monitoring | M | 모니터링, 로깅, 관측성 |
| Network | N | 네트워크 인프라, 통신 |
| Security | S | 보안 기능, 방어 체계 |
| Application | A | 애플리케이션 계층 기능 |
| Data | D | 데이터 처리, 저장 |
| Resource | R | 리소스 관리, 스케일링 |
| Compliance | C | 규정 준수, 거버넌스 |
| Platform | P | 플랫폼 서비스, DevOps |
| TechStack | T | 기술 스택, 프레임워크 |
| Interface | I | 인터페이스, API |

### 4.2 Security 도메인 태그 (S)

취약점 매핑에 가장 많이 사용되는 Security 태그:

```yaml
S1_Perimeter_Security:
  S1.1: Firewall
  S1.2: IDS/IPS
  S1.3: WAF
  S1.4: DDoS_Protection

S2_Auth:
  S2.1: Authentication
  S2.2: Authorization
  S2.3: Session_Management
  S2.4: SSO

S3_Data_Protection:
  S3.1: Encryption_At_Rest
  S3.2: Encryption_In_Transit
  S3.3: Key_Management
  S3.4: Data_Masking

S4_Vulnerability_Management:
  S4.1: Vulnerability_Scanning
  S4.2: Patch_Management
  S4.3: Penetration_Testing

S5_SIEM:
  S5.1: Log_Aggregation
  S5.2: Threat_Detection
  S5.3: Incident_Response

S6_IAM:
  S6.1: Identity_Management
  S6.2: Access_Control
  S6.3: Privilege_Management

S7_AppSec:
  S7.1: SAST
  S7.2: DAST
  S7.3: SCA
  S7.4: IAST

S8_Compliance:
  S8.1: Policy_Enforcement
  S8.2: Audit_Logging
  S8.3: Regulatory_Compliance
```

### 4.3 CWE → Tag 매핑 테이블

| CWE | 취약점 유형 | Primary Tag | Detection Tags | Mitigation Tags |
|-----|------------|-------------|----------------|-----------------|
| CWE-79 | XSS | A3.1 | S7.2, M1.2 | S7.1, A3.1 |
| CWE-89 | SQL Injection | D2.1 | S7.2, S5.2 | S7.1, D2.1 |
| CWE-94 | Code Injection | A2.1 | S7.2, S5.2 | S7.1, A3.1 |
| CWE-200 | Information Exposure | S3.4 | S5.1, M1.2 | S3.1, S6.2 |
| CWE-284 | Improper Access Control | S2.2 | S5.2, M1.2 | S6.2, S2.2 |
| CWE-287 | Improper Authentication | S2.1 | S5.2, M1.2 | S2.1, S6.1 |
| CWE-352 | CSRF | A3.2 | S7.2, M1.2 | A3.2, S2.3 |
| CWE-434 | Unrestricted Upload | A4.1 | S7.2, S5.2 | A4.1, S7.1 |
| CWE-502 | Deserialization | A2.2 | S7.1, S5.2 | S7.3, A2.2 |
| CWE-611 | XXE | A3.3 | S7.2, S5.2 | S7.1, A3.3 |
| CWE-787 | Out-of-bounds Write | A2.3 | S7.1, M1.2 | S7.1, A2.3 |
| CWE-918 | SSRF | N2.1 | S7.2, S5.2 | N2.1, S1.1 |

---

## 5. 신뢰도(Confidence) 계산

### 5.1 신뢰도 요소

| 요소 | 가중치 | 설명 |
|------|--------|------|
| CWE 매핑 존재 | 0.30 | 기존 CWE-GR 매핑이 있는 경우 |
| 키워드 일치도 | 0.25 | 설명 키워드와 태그 키워드 일치 |
| CPE 매핑 | 0.20 | 제품 정보로 Layer 특정 가능 |
| 유사 CVE 매핑 | 0.15 | 유사한 CVE의 매핑 참조 |
| CVSS 벡터 활용 | 0.10 | Attack Vector로 Zone 추정 |

### 5.2 신뢰도 계산 공식

```python
confidence = (
    cwe_mapping_score * 0.30 +
    keyword_match_score * 0.25 +
    cpe_mapping_score * 0.20 +
    similar_cve_score * 0.15 +
    cvss_vector_score * 0.10
)

# 결과 해석
# >= 0.90: 높은 신뢰도 → 자동 승인 가능
# 0.70 ~ 0.89: 중간 신뢰도 → 검토 권장
# < 0.70: 낮은 신뢰도 → 수동 검토 필수
```

### 5.3 신뢰도 향상 전략

```yaml
낮은_신뢰도_케이스:
  - CWE 없음 + 새로운 유형의 취약점
  - 설명이 모호하거나 짧음
  - 영향받는 제품 정보 부족

신뢰도_향상_방법:
  - 참조 URL에서 추가 정보 수집
  - 유사 취약점 클러스터링
  - 수동 검토 후 피드백 루프
  - Named Vulnerability 정보 활용
```

---

## 6. 매핑 예시

### 6.1 Log4Shell (CVE-2021-44228)

**입력:**
```json
{
  "cve_id": "CVE-2021-44228",
  "description": "Apache Log4j2 2.0-beta9 through 2.15.0 (excluding security releases 2.12.2, 2.12.3, and 2.3.1) JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints.",
  "cwe_id": "CWE-502",
  "cvss_score": 10.0,
  "cpe": "cpe:2.3:a:apache:log4j:*:*:*:*:*:*:*:*"
}
```

**출력:**
```json
{
  "layer": ["L7", "L4", "L6"],
  "zone": ["Zone_2", "Zone_3"],
  "primary_tag": "A1.3",
  "detection_tags": ["S7.3", "S5.2", "M1.2"],
  "mitigation_tags": ["S7.3", "P2.1", "S4.2"],
  "confidence": 0.95,
  "reasoning": {
    "layer": "Log4j는 Application Layer(L7) 로깅 라이브러리이나, 빌드 도구(L4), 컨테이너 런타임(L6)에도 영향",
    "zone": "웹 애플리케이션 영역(Zone_2)에서 주로 발생, 데이터 유출 가능성으로 Zone_3도 포함",
    "tags": "CWE-502 역직렬화 취약점, JNDI 인젝션 관련"
  }
}
```

### 6.2 ProxyLogon (CVE-2021-26855)

**입력:**
```json
{
  "cve_id": "CVE-2021-26855",
  "description": "Microsoft Exchange Server Remote Code Execution Vulnerability. This CVE ID is unique from CVE-2021-26857, CVE-2021-26858, CVE-2021-27065.",
  "cwe_id": "CWE-918",
  "cvss_score": 9.1,
  "cpe": "cpe:2.3:a:microsoft:exchange_server:*:*:*:*:*:*:*:*"
}
```

**출력:**
```json
{
  "layer": ["L7", "L2"],
  "zone": ["Zone_1", "Zone_2"],
  "primary_tag": "N2.1",
  "detection_tags": ["S5.2", "S1.2", "M1.2"],
  "mitigation_tags": ["S1.3", "S4.2", "N2.1"],
  "confidence": 0.92,
  "reasoning": {
    "layer": "Exchange는 Application(L7)이나 SSRF로 인해 Network(L2) 영역도 영향",
    "zone": "외부 접근 가능한 Perimeter(Zone_1)와 내부 Application(Zone_2)",
    "tags": "CWE-918 SSRF, 원격 코드 실행 가능"
  }
}
```

---

## 7. AI 분류기 시스템 프롬프트 템플릿

```markdown
당신은 GR Framework의 취약점 분류 전문가입니다.

## 작업
주어진 CVE 취약점을 GR Framework의 3차원 좌표로 매핑하세요.

## 입력 정보
- CVE ID: {cve_id}
- 설명: {description}
- CWE: {cwe_id}
- CVSS: {cvss_score}
- CPE: {cpe}

## 매핑 기준
1. Layer (L1~L7, CrossLayer)
2. Zone (Zone_0A, Zone_0B, Zone_1~Zone_5)
3. Tags (Primary, Detection[], Mitigation[])

## 출력 형식
JSON 형식으로 응답하세요:
{
  "layer": ["L?"],
  "zone": ["Zone_?"],
  "primary_tag": "??.?",
  "detection_tags": ["??.?", "??.?"],
  "mitigation_tags": ["??.?", "??.?"],
  "confidence": 0.00,
  "reasoning": {
    "layer": "Layer 선택 이유",
    "zone": "Zone 선택 이유",
    "tags": "Tag 선택 이유"
  }
}

## 참조
- CWE-Tag 매핑: 04_CVE_GR_매핑_가이드.md 참조
- Layer 키워드: 본 문서 섹션 2.2 참조
- Zone 판단 기준: 본 문서 섹션 3.2 참조
```

---

## 8. 버전 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2025-12-01 | 초기 버전 생성 |

---

## 9. 관련 문서

- [00_취약점_카탈로그_개요.md](./00_취약점_카탈로그_개요.md) - 카탈로그 개요
- [01_CWE_카탈로그.md](./01_CWE_카탈로그.md) - CWE 정의 및 매핑
- [05_취약점_분류_기준.md](./05_취약점_분류_기준.md) - AI 분류 기준
- [Domain_S_Security.md](../03_차원3_Function_Tag/Domain_S_Security.md) - Security 태그 정의
